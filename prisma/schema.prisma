generator client {
  provider      = "prisma-client"
  output        = "../src/generated/prisma"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Author {
  id    String @id @default(uuid())
  name  String @unique
  books Book[]
}

model Book {
  id         String      @id @default(uuid())
  name       String
  authorId   String
  pdfPath    String?
  inProgress Boolean     @default(false)
  author     Author      @relation(fields: [authorId], references: [id], onDelete: Cascade)
  tracks     Track[]
  videos     BookVideo[]
  chapters   Chapter[]

  @@unique([name, authorId])
}

model Chapter {
  id        String      @id @default(uuid())
  name      String
  bookId    String
  sortOrder Int         @default(0)
  book      Book        @relation(fields: [bookId], references: [id], onDelete: Cascade)
  tracks    Track[]
  videos    BookVideo[]
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@index([bookId])
}

model Track {
  id            String   @id @default(uuid())
  title         String
  trackNumber   Int
  filePath      String   @unique
  duration      Float
  bookId        String
  chapterId     String?
  sortOrder     Int      @default(0)
  pdfPage       Int?
  completed     Boolean  @default(false)
  tempo         Int?
  timeSignature String   @default("4/4")
  markers       Marker[]
  book          Book     @relation(fields: [bookId], references: [id], onDelete: Cascade)
  chapter       Chapter? @relation(fields: [chapterId], references: [id], onDelete: SetNull)

  @@index([bookId])
  @@index([chapterId])
}

model Marker {
  id        String @id @default(uuid())
  name      String
  timestamp Float
  trackId   String
  track     Track  @relation(fields: [trackId], references: [id], onDelete: Cascade)

  @@index([trackId])
}

model BookVideo {
  id          String   @id @default(uuid())
  filename    String
  title       String?
  filePath    String   @unique
  duration    Float?
  sortOrder   Int      @default(0)
  trackNumber Int?
  pdfPage     Int?
  completed   Boolean  @default(false)
  bookId      String
  chapterId   String?
  book        Book     @relation(fields: [bookId], references: [id], onDelete: Cascade)
  chapter     Chapter? @relation(fields: [chapterId], references: [id], onDelete: SetNull)
  createdAt   DateTime @default(now())

  @@index([bookId])
  @@index([chapterId])
}

model Video {
  id        String   @id @default(uuid())
  title     String
  youtubeId String
  sortOrder Int      @default(0)
  category  String?
  createdAt DateTime @default(now())
}

model JamTrack {
  id            String           @id @default(uuid())
  title         String
  filePath      String           @unique
  duration      Float
  completed     Boolean          @default(false)
  tempo         Int?
  timeSignature String           @default("4/4")
  markers       JamTrackMarker[]
  pdfs          JamTrackPdf[]
  createdAt     DateTime         @default(now())
}

model JamTrackMarker {
  id         String   @id @default(uuid())
  name       String
  timestamp  Float
  jamTrackId String
  jamTrack   JamTrack @relation(fields: [jamTrackId], references: [id], onDelete: Cascade)

  @@index([jamTrackId])
}

model JamTrackPdf {
  id             String          @id @default(uuid())
  name           String
  filePath       String          @unique
  sortOrder      Int             @default(0)
  jamTrackId     String
  jamTrack       JamTrack        @relation(fields: [jamTrackId], references: [id], onDelete: Cascade)
  pageSyncPoints PageSyncPoint[]

  @@index([jamTrackId])
}

model PageSyncPoint {
  id            String      @id @default(uuid())
  timeInSeconds Float
  pageNumber    Int
  jamTrackPdfId String
  jamTrackPdf   JamTrackPdf @relation(fields: [jamTrackPdfId], references: [id], onDelete: Cascade)

  @@index([jamTrackPdfId])
}

model GuitarTab {
  id            String   @id @default(uuid())
  title         String
  filePath      String   @unique
  tempo         Int?
  timeSignature String?
  duration      Float?
  completed     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
